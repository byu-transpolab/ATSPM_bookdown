---
title: "ATSPM Data Analysis"
author:
  - name: Matthew Davis
    email: mabosdavis@gmail.com
    affiliation: Brigham Young University
    footnote: 1
  - name: Gregory Macfarlane
    email: gregmacfarlane@byu.edu
    affiliation: Brigham Young University
    footnote: 2
address:
  - code: Brigham Young University
    address: Civil and Environmental Engineering Department, 430 Engineering Building, Provo, Utah 84602
footnote:
  - code: 1
    text: "Corresponding Author"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: article
journal: "Journal"
bibliography: [book.bib]
biblio-style: apalike
link-citations: yes
abstract: |
  This is where the abstract should go.
description: "A short description"
layout: "3p, authoryear"
keywords:
  - COVID-19
  - Traffic volumes
  - ATSPM
---

# Question {#intro}

Since December 2019, the COVID-19 pandemic has affected life around the world in an unprecedented manner. Mask mandates, social distancing, and stay-at-home orders have changed the way society lives, works, and interacts. With these safety precautions have come less interaction, traveling, and driving on roads and highways. Recent research has confirmed that the COVID-19 pandemic has led to a decrease in traffic volumes across the United States and the world.

Although this is a recent event, the topic has already been researched in many states and countries [@Lee2020; @Lee2021; @Muley2021], but has not been specifically looked at for Utah and Salt Lake Counties in Utah, USA. These counties also contain signal specific traffic volume detectors, which provide a detailed insight into the variation of the effect of COVID-19 on traffic volumes in different locations. The research question therefore is:

  - What was the effect of COVID-19 on traffic volumes in Utah and Salt Lake Counties?

<!--chapter:end:index.Rmd-->

# Methods

```{r methodssetup, include = FALSE}
# load R libraries here; the `include` flag in the chunk options above tells
# whether to print the results or not. Usually you don't want to print the
# library statements, or any code on the pdf.

# Main Packages ========
# I use these in every doc
library(tidyverse)
library(knitr)
library(kableExtra)
library(modelsummary)

options(dplyr.summarise.inform = FALSE)

# Other packages ------
# These sometimes get used, and sometimes don't.
library(mlogit)

# Instructions and options =========
# prints missing data in tables as blank space
options(knitr.kable.NA = '') 
# tells kableExtra to not load latex table packages in the chunk output
options(kableExtra.latex.load_packages = FALSE) 

# round and format numbers that get printed in the text of the article.
inline_hook <- function(x) {
  if (is.numeric(x)) {
    format(x, digits = 3, big.mark = ",")
  } else x
}
knitr::knit_hooks$set(inline = inline_hook)

knitr::opts_chunk$set(echo = TRUE, cache = TRUE)

# options for latex-only output
if(knitr::is_latex_output()) {
  knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
} 

```


UDOT provided volume data for many signals, but for the purposes of this research, significantly fewer signals were actually analyzed. Data was collected from traffic volume detectors in Provo, Orem, and Cottonwood Heights, Utah and then processed through UDOT's Automated Traffic Signal Performance Measures (ATSPM) system. Data was provided for downtown Provo, Orem State Street, University Avenue, Orem 800 N, and Fort Union Boulevard in Cottonwood Heights for the years 2017-2020, but many of the data were plagued by detector issues. Common issues ranged from shifting of the data up or down considerably and then shifting back after a period of time, missing data, or lack of data in general. Only four signals from Fort Union Blvd and three signals from Orem 800 N were ultimately deemed as complete and consistent enough to be used in the analysis.

A general linear regression and four fixed effect models were created to evaluate the effect of COVID-19 on volume in the aforementioned corridors. Fixed effects models were created for day of the week, month, whether or not it was during the COVID-19 pandemic, and individual signals. To divide the Pre COVID-19 time period from the COVID-19 time period, a separation date was chosen. In Utah, on March 12, 2020, Governor Cox announced that gatherings over 100 people should be canceled, as well as many of the universities in the state making the formal announcement that they would transition to online school for the remainder of the semester. These announcements were one of the first events of the pandemic that directly affected the lives of the public in Utah, hence it being chosen as the separation date.

```{r load_data}
Volume_reg <- read_rds("data/Volume_reg.rds")
```

```{r datasummary, fig.cap="Traffic volumes at State St and 800 N in Orem, UT before and during the COVID-19 pandemic."}
library(tidyverse)

#Graph Signal Specific Volumes
Volume_reg%>%
  filter(
    timeperiod == "PMPeak",
    SignalId == 4024) %>%
  ggplot(aes(x= BinStartTime, y = Volume_hour, color = hour)) +
  geom_point() +
  xlab("Time") +
  ylab("Volume (vehicles per hour)")
```

Variation in traffic volumes are dependent on multiple factors such as season, time of day, and day of the week. These three factors were controlled for and were limited to focus the analysis. For days of the week, only Tuesday, Wednesday and Thursday were analyzed. The density of vehicles was greatest during the hours of 7AM to 9AM and 4PM to 6PM, or the "AM Peak" and "PM Peak" respectively, but only the "PM Peak" data were used in the analysis. Other potential factors include weather and road conditions, sporting events and major holidays. Theses were not accounted for in the analysis.

<!--chapter:end:03-method.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Findings
```{r setup, include = FALSE}
library(tidyverse)
library(modelsummary)
library(kableExtra)
```
During the analysis, several variables were found to have a statistically significant effect on traffic. Month of the year, the time period of the COVID-19 pandemic, and difference in traffic signals were all found to have a significant effect on vehicles per hour of phases 2 and 6 of the signals specified in the methods section. This is seen in Table \@ref(tab:general).

Each individual factor was given a fixed effects model to further investigate where significant factors occurred. Table \@ref(tab:FEmonth) shows that with January as the reference, each month, except for May, was statistically significant. Standard errors were similar across the year, with beta intercepts vary widely. The effect of day of the week though was the complete opposite. Table \@ref(tab:FEday) shows that day of the week had little to no affect on variations in hourly volume. Difference in whether or not a date was occuring after March 12, 2021, which was assumed to be the start of the COVID-19 pandemic shutdown in Utah, was shown to be significant in Table \@ref(tab:FECOVID). Individual signals were also shown to be significant in Table \@ref(tab:FESignal).

Like with any research, there were significant limitations to the data and analyses. Through the data cleaning process, it became very clear that many of the data provided were not complete or contained detector errors, leaving most of the data unusable. From 52 signals originally with data, only 7 were used in this analysis. Even with the most accurate data available, further detector error or unknown errors could be present. Other factors such as weather, holidays and major events, school openings, weather, and road conditions were not controlled for.

While not perfect, this analysis provides the conclusion that despite seasonal and signal specific variation, hourly volumes were significantly affected by the COVID-19 pandemic.

Note: The Methods section still needs to be updated to reflect the changes in methodology made in the last few days.


Base controls for Signals, COVID is base, but also controlling for COVID. Controls is Base controlling for everything, including day of week and month. R-squared value goes up, beta for COVID becomes more pronounced, quantify how much of an effect COVID had.

```{r general}
# Read in Volume dataset
Volume_reg <- read_rds("data/Volume_reg.rds")

# General Linear Regression Model
base <- lm(Volume_hour ~ factor(SignalId), data = Volume_reg)
covid_Base <- update(base, formula = . ~ . + COVID)
covid_controls <- update(covid_Base, formula = . ~ . + factor(month) + factor(day))

```

```{r modeltab}
modelsummary(list("Base" = base, "COVID" = covid_Base, "Controls" = covid_controls),
             estimate = "{estimate}{stars}", statistic = NULL, 
             output = 'kableExtra',
             gof_omit = 'IC|Log|Adj',
             coef_map = c(
               "(Intercept)" = "Intercept",
               "factor(SignalId)4090" = "4090",
               "factor(SignalId)4704" = "4704",
               "factor(SignalId)4705" = "4705",
               "factor(SignalId)6303" = "6303",
               "factor(SignalId)6304" = "6304",
               "factor(SignalId)6307" = "6307",
               "COVIDTRUE" = "COVID",
               "factor(month)2" = "February",
               "factor(month)3" = "March",
               "factor(month)4" = "April",
               "factor(month)5" = "May",
               "factor(month)6" = "June",
               "factor(month)7" = "July",
               "factor(month)8" = "August",
               "factor(month)9" = "September",
               "factor(month)10" = "October",
               "factor(month)11" = "November",
               "factor(month)12" = "December",
               "factor(day)4" = "Wednesday",
               "factor(day)5" = "Thursday")) %>%
  kable_styling() %>%
  row_spec(8, color = 'red') %>%
  group_rows("Signal", 2, 7) %>%
  group_rows("COVID-19", 8, 8) %>%
  group_rows("Month", 9, 19) %>%
  group_rows("Day", 20, 21)
```


<!--chapter:end:05-summary.Rmd-->

`r if (knitr::is_html_output()) '
# Acknowledgements {-}
'`

<!--chapter:end:06-references.Rmd-->

